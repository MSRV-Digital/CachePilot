#
# CachePilot - System Configuration
#
# Main configuration file for CachePilot multi-tenant Redis management system.
# Defines paths, network settings, defaults, and security parameters.
#
# Author: Patrick Schlesinger <cachepilot@msrv-digital.de>
# Company: MSRV Digital
# Version: 2.2.0-beta
# License: MIT
#
# Copyright (c) 2025 Patrick Schlesinger, MSRV Digital
#

# Base installation paths
# Following Linux Filesystem Hierarchy Standard (FHS) for better system integration
paths:
  # Application code and scripts (unchanged - /opt is standard for add-on software)
  base_dir: /opt/cachepilot
  cli_dir: /opt/cachepilot/cli
  api_dir: /opt/cachepilot/api
  frontend_dir: /opt/cachepilot/frontend
  config_dir: /etc/cachepilot
  scripts_dir: /opt/cachepilot/scripts
  
  # Variable data directories (FHS-compliant - /var for variable application data)
  # These directories contain data that changes during operation
  tenants_dir: /var/cachepilot/tenants      # Tenant-specific data and configurations
  ca_dir: /var/cachepilot/ca                # Certificate Authority and TLS certificates
  backups_dir: /var/cachepilot/backups      # Backup archives
  
  # Log directories (FHS-compliant - /var/log for application logs)
  # Centralized logging location for easier log management and monitoring
  logs_dir: /var/log/cachepilot             # All application logs
  
  # Note: All paths can be overridden via environment variables
  # Example: export TENANTS_DIR=/custom/path/tenants

# Network configuration
# IMPORTANT: Configure these values for your deployment
#
# Port Range Strategy (v2.2+):
# CachePilot supports dual-mode operation (TLS + Plain-Text) for up to 300 tenants.
# The port ranges are split to ensure consistent port pairing and avoid collisions:
#
#   TLS Ports:        7300-7599 (300 ports)
#   Plain-Text Ports: 7600-7899 (300 ports)
#   Total Capacity:   300 dual-mode tenants OR 600 single-mode tenants
#
# Port Pairing Pattern:
#   Tenant with TLS port 7300 → Plain-Text port 7600 (+300 offset)
#   Tenant with TLS port 7301 → Plain-Text port 7601 (+300 offset)
#   This makes troubleshooting and port management predictable.
#
# Security Modes (per tenant):
#   - tls-only:    Default, most secure (requires CA certificate)
#   - dual-mode:   Both TLS and Plain-Text active (flexibility)
#   - plain-only:  Plain-Text with password only (simpler, less secure)
network:
  internal_ip: 10.0.0.27       # Internal server IP address
  public_ip: 159.69.9.24       # Public-facing IP address or domain
  
  # Redis Port Ranges (v2.2+: Expanded for 300 dual-mode tenants)
  redis_port_start: 7300              # Start of TLS port range
  redis_port_end: 7899                # End of entire port range (TLS + Plain-Text)
  redis_tls_port_end: 7599            # End of TLS range / Split point
  redis_plain_port_start: 7600        # Start of Plain-Text range
  
  # RedisInsight Port Range (expanded for 300 tenants)
  insight_port_start: 8300
  insight_port_end: 8599

# Default resource limits
defaults:
  redis_memory_mb: 256
  docker_memory_mb: 512
  
  # Security Mode (v2.2+)
  # Default security mode for new tenants
  # Options: tls-only (recommended), dual-mode, plain-only
  security_mode: tls-only
  
  # Persistence Mode (v2.2+)
  # Default persistence mode for new tenants
  # Options: memory-only (recommended, lowest latency), persistent (durability)
  # memory-only: Pure in-memory, no disk writes, 1-5ms latency
  # persistent: Traditional AOF + RDB, data survives restarts, 100-200ms latency
  persistence_mode: memory-only

# Organization information
# Configure these values for handover packages and documentation
organization:
  name: "Your Organization"
  contact_name: "Administrator"
  contact_email: "admin@example.com"
  contact_phone: "not-configured"
  contact_web: "https://example.com"

# TLS Certificate settings
certificates:
  country: "DE"
  state: "Bavaria"
  city: "Munich"
  validity_days: 1095

# Monitoring and health check settings
monitoring:
  health_check_interval: 300
  alert_retention_days: 30
  metrics_retention_days: 90

# Backup settings
backup:
  retention_days: 30
  compression: true
  verify_after_backup: true

# Security settings
security:
  # File permissions for sensitive files (certificates, keys, configs)
  sensitive_file_permissions: "600"  # Owner read/write only
  sensitive_dir_permissions: "700"   # Owner full access only
  
  # Audit logging
  audit_log_enabled: true
  audit_log_file: /var/log/cachepilot/security.log  # Updated to FHS-compliant path
  audit_log_retention_days: 90
  
  # Password generation
  password_min_length: 32
  password_complexity: true  # Requires uppercase, lowercase, numbers, special chars
  
  # Command execution
  command_timeout_seconds: 30
  command_whitelist_enabled: true
  
  # File path validation
  path_traversal_protection: true
  allowed_base_directories:
    - /opt/cachepilot
    - /etc/cachepilot
    - /var/cachepilot
    - /var/log/cachepilot
